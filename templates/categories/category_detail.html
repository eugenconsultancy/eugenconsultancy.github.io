{% extends 'base.html' %}
{% load static %}

{% block title %}{{ category.name }} - Eugen Web Development{% endblock %}

{% block content %}
<style>
    /* Base font settings */
    body {
        font-size: 16px !important;
        line-height: 1.7;
    }
    
    /* All text elements - extra bold for maximum contrast */
    .glass-card, p, h1, h2, h3, h4, h5, h6, span, div, a, li {
        font-weight: 600 !important;
    }
    
    /* Ultra bold for headings */
    h1, h2, .display-4, .section-title {
        font-weight: 900 !important;
        letter-spacing: -0.02em;
    }
    
    /* Section title styling */
    .section-title {
        font-size: 2rem !important;
        color: #0b2b40;
        position: relative;
        display: inline-block;
        margin-bottom: 30px;
        padding-bottom: 15px;
    }
    
    .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
        border-radius: 2px;
    }
    
    /* Category header card */
    .category-header {
        background: white !important;
        border: 3px solid #4ecdc4;
        border-radius: 30px;
        padding: 40px;
        box-shadow: 0 30px 50px rgba(0,0,0,0.1);
    }
    
    /* Gradient heading */
    .gradient-heading {
        background: linear-gradient(135deg, #0b2b40, #4a6fa5, #4ecdc4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 3.5rem !important;
        font-weight: 900 !important;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Badge styling */
    .category-badge {
        padding: 10px 20px !important;
        border-radius: 40px !important;
        font-size: 15px !important;
        font-weight: 700 !important;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .badge-type {
        background: linear-gradient(135deg, #ff6b6b, #ff8e53) !important;
        color: white !important;
    }
    
    .badge-count {
        background: linear-gradient(135deg, #4a6fa5, #6b8cff) !important;
        color: white !important;
    }
    
    /* Description text */
    .category-description {
        font-size: 1.2rem !important;
        color: #2c3e50 !important;
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background: rgba(78, 205, 196, 0.05);
        border-radius: 20px;
        border-left: 5px solid #4ecdc4;
    }
    
    /* Parent category link */
    .parent-link {
        display: inline-block;
        padding: 10px 25px;
        background: rgba(255, 107, 107, 0.1);
        border-radius: 40px;
        color: #ff6b6b !important;
        font-weight: 700 !important;
        border: 2px solid #ff6b6b;
        transition: all 0.3s ease;
    }
    
    .parent-link:hover {
        background: #ff6b6b;
        color: white !important;
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
    }
    
    /* Subcategory cards */
    .subcategory-card {
        background: white !important;
        border: 2px solid #4ecdc4;
        border-radius: 20px;
        padding: 25px 15px;
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
        box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    }
    
    .subcategory-card:hover {
        transform: translateY(-8px);
        border-color: #ff6b6b;
        box-shadow: 0 20px 30px rgba(255, 107, 107, 0.2);
    }
    
    .subcategory-card i {
        font-size: 2.5rem;
        margin-bottom: 15px;
        background: linear-gradient(135deg, #ff6b6b, #ff8e53);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .subcategory-card h3 {
        color: #0b2b40 !important;
        font-size: 1.1rem !important;
        margin-bottom: 8px;
    }
    
    .subcategory-card .item-count {
        color: #4a6fa5 !important;
        font-size: 13px;
        font-weight: 700 !important;
    }
    
    /* Media items */
    .media-item {
        background: white !important;
        border: 2px solid #e0e0e0;
        border-radius: 16px;
        padding: 12px;
        transition: all 0.3s ease;
        height: 100%;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }
    
    .media-item:hover {
        transform: translateY(-5px);
        border-color: #4ecdc4;
        box-shadow: 0 15px 30px rgba(78, 205, 196, 0.2);
    }
    
    .media-thumbnail {
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 10px;
        position: relative;
    }
    
    .media-thumbnail img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .media-item:hover .media-thumbnail img {
        transform: scale(1.1);
    }
    
    .media-type-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 107, 107, 0.9);
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 700 !important;
        backdrop-filter: blur(5px);
        border: 1px solid white;
    }
    
    .media-title {
        color: #0b2b40 !important;
        font-size: 14px !important;
        font-weight: 800 !important;
        margin-bottom: 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .media-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #2c3e50;
        font-size: 12px;
        font-weight: 600 !important;
    }
    
    .media-meta i {
        margin-right: 3px;
    }
    
    .views {
        color: #ff6b6b;
    }
    
    .year {
        color: #4a6fa5;
        background: rgba(74, 111, 165, 0.1);
        padding: 3px 8px;
        border-radius: 20px;
    }
    
    /* Empty state */
    .empty-state {
        background: white !important;
        border: 3px dashed #4ecdc4;
        border-radius: 30px;
        padding: 60px 30px;
        text-align: center;
    }
    
    .empty-state i {
        font-size: 5rem;
        color: rgba(78, 205, 196, 0.3);
        margin-bottom: 20px;
    }
    
    .empty-state h3 {
        color: #0b2b40;
        font-size: 1.8rem !important;
        margin-bottom: 10px;
    }
    
    .empty-state p {
        color: #2c3e50;
        font-size: 1.1rem;
    }
    
    /* Pagination */
    .pagination {
        gap: 8px;
    }
    
    .page-link {
        background: white !important;
        border: 2px solid #4ecdc4 !important;
        color: #0b2b40 !important;
        font-weight: 700 !important;
        padding: 12px 18px;
        border-radius: 12px !important;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }
    
    .page-link:hover {
        background: #4ecdc4 !important;
        color: white !important;
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(78, 205, 196, 0.3);
    }
    
    .page-item.active .page-link {
        background: linear-gradient(135deg, #ff6b6b, #ff8e53) !important;
        border-color: #ff6b6b !important;
        color: white !important;
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }
    
    .page-item.disabled .page-link {
        background: #f0f0f0 !important;
        border-color: #d0d0d0 !important;
        color: #a0a0a0 !important;
    }
</style>

<div class="container">
    <!-- Category Header -->
    <div class="row mb-5" data-aos="fade-up">
        <div class="col-lg-10 mx-auto">
            <div class="category-header">
                {% if category.cover_image %}
                <div class="mb-4 rounded-4 overflow-hidden" style="max-height: 350px; border: 3px solid #4ecdc4;">
                    <img src="{{ category.cover_image.url }}" class="w-100" alt="{{ category.name }}" style="object-fit: cover;">
                </div>
                {% endif %}
                
                <div class="text-center">
                    <!-- Category Icon -->
                    {% if category.icon %}
                    <i class="fas {{ category.icon }} fa-4x mb-3" style="color: #ff6b6b;"></i>
                    {% endif %}
                    
                    <h1 class="gradient-heading">{{ category.name }}</h1>
                    
                    <div class="d-flex justify-content-center gap-3 mb-4">
                        <span class="category-badge badge-type">
                            <i class="fas fa-tag me-2"></i> {{ category.get_category_type_display }}
                        </span>
                        <span class="category-badge badge-count">
                            <i class="fas fa-images me-2"></i> {{ category.media_count }} items
                        </span>
                    </div>
                    
                    {% if category.description %}
                    <div class="category-description">
                        <i class="fas fa-quote-left me-2" style="color: #4ecdc4; opacity: 0.5;"></i>
                        {{ category.description }}
                        <i class="fas fa-quote-right ms-2" style="color: #4ecdc4; opacity: 0.5;"></i>
                    </div>
                    {% endif %}
                    
                    {% if category.parent %}
                    <div class="mt-4">
                        <a href="{% url 'categories:detail' category.parent.slug %}" class="parent-link">
                            <i class="fas fa-arrow-left me-2"></i> Parent Category: {{ category.parent.name }}
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Subcategories -->
    {% if category.children.all %}
    <div class="row mb-5" data-aos="fade-up">
        <div class="col-12">
            <h2 class="section-title">
                <i class="fas fa-sitemap me-3" style="color: #4ecdc4;"></i>Subcategories
            </h2>
        </div>
        
        {% for subcategory in category.children.all %}
        <div class="col-lg-3 col-md-4 col-6 mb-4">
            <a href="{% url 'categories:detail' subcategory.slug %}" class="text-decoration-none">
                <div class="subcategory-card">
                    {% if subcategory.icon %}
                    <i class="fas {{ subcategory.icon }} fa-3x mb-3"></i>
                    {% else %}
                    <i class="fas fa-folder-open fa-3x mb-3"></i>
                    {% endif %}
                    <h3>{{ subcategory.name }}</h3>
                    <span class="item-count">
                        <i class="fas fa-image me-1"></i> {{ subcategory.media_count }} items
                    </span>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Media Items -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="section-title">
                <i class="fas fa-photo-video me-3" style="color: #ff6b6b;"></i>Media in this Category
            </h2>
        </div>
    </div>
    
    <div class="row g-4">
        {% for item in media_items %}
        <div class="col-lg-3 col-md-4 col-6" data-aos="fade-up" data-aos-delay="{{ forloop.counter|add:'50' }}">
            <a href="{{ item.get_absolute_url }}" class="text-decoration-none">
                <div class="media-item">
                    <div class="media-thumbnail">
                        {% if item.media_type == 'image' %}
                            <img src="{{ item.file.url }}" alt="{{ item.title }}">
                        {% else %}
                            {% if item.thumbnail %}
                            <img src="{{ item.thumbnail.url }}" alt="{{ item.title }}">
                            {% else %}
                            <div style="height: 150px; background: linear-gradient(135deg, #4ecdc4, #38b2ac); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-play-circle fa-4x" style="color: white;"></i>
                            </div>
                            {% endif %}
                        {% endif %}
                        
                        {% if item.media_type == 'video' %}
                        <span class="media-type-badge">
                            <i class="fas fa-video me-1"></i> Video
                        </span>
                        {% endif %}
                        
                        {% if item.featured %}
                        <span class="media-type-badge" style="background: linear-gradient(135deg, #f7d44a, #ff8e53); left: 10px; right: auto;">
                            <i class="fas fa-star me-1"></i> Featured
                        </span>
                        {% endif %}
                    </div>
                    
                    <h4 class="media-title">{{ item.title }}</h4>
                    
                    <div class="media-meta">
                        <span class="views">
                            <i class="fas fa-eye"></i> {{ item.view_count }}
                        </span>
                        {% if item.date_taken %}
                        <span class="year">
                            {{ item.date_taken|date:"Y" }}
                        </span>
                        {% endif %}
                    </div>
                    
                    {% if item.categories.exists %}
                    <div class="mt-2 d-flex flex-wrap gap-1">
                        {% for cat in item.categories.all|slice:":2" %}
                        <span class="badge" style="background: rgba(78, 205, 196, 0.1); color: #4ecdc4; font-size: 9px; padding: 3px 6px;">
                            {{ cat.name|truncatechars:10 }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </a>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="empty-state">
                <i class="fas fa-images"></i>
                <h3>No Media Found</h3>
                <p>There are no media items in this category yet. Check back later for new additions!</p>
                <a href="{% url 'media:list' %}" class="btn" style="background: #4ecdc4; color: white; padding: 12px 30px; border-radius: 40px; font-weight: 700; margin-top: 20px;">
                    <i class="fas fa-arrow-left me-2"></i>Browse All Media
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if is_paginated %}
    <div class="row mt-5" data-aos="fade-up">
        <div class="col-12">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if media_items.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ media_items.previous_page_number }}" aria-label="Previous">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link"><i class="fas fa-chevron-left"></i></span>
                    </li>
                    {% endif %}
                    
                    {% for num in media_items.paginator.page_range %}
                        {% if num == media_items.number %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > media_items.number|add:'-3' and num < media_items.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                        </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if media_items.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ media_items.next_page_number }}" aria-label="Next">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link"><i class="fas fa-chevron-right"></i></span>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
    {% endif %}
</div>

<!-- Counter Animation Script (optional) -->
<script>
    // Animate any counters if needed
    document.addEventListener('DOMContentLoaded', function() {
        const counters = document.querySelectorAll('.stat-number');
        counters.forEach(counter => {
            const updateCount = () => {
                const target = parseInt(counter.getAttribute('data-value'));
                const count = parseInt(counter.innerText);
                const increment = target / 50;
                
                if (count < target) {
                    counter.innerText = Math.ceil(count + increment);
                    setTimeout(updateCount, 20);
                } else {
                    counter.innerText = target;
                }
            };
            updateCount();
        });
    });
</script>
{% endblock %}